language: node_js
node_js:
- node
git:
  depth: 99999
branches:  
  only:
    - master
notifications:
- email: false
before_script:
  - npm test
script:
  - gulp
before_cache:
  - rm -rf ./node_modules
  - rm -rf ./tests
  - rm -rf ./src
  - rm -rf ./bin/fakeDataFeeder
  - rm -rf ./bin/messageProcessor
deploy:
  - provider: azure_web_apps
    skip_cleanup: true
    verbose: true
    site: barfer
    script:
        - rm -rf ./bin/usersService
        - rm -rf ./bin/barfsService
  - provider: azure_web_apps
    skip_cleanup: true
    verbose: true
    site: api-barfer
    script:
        - rm -rf ./bin/usersService
        - rm -rf ./bin/web
        - rm ./package.json
        - mv ./package.barfsService.json ./package.json
  - provider: azure_web_apps
    skip_cleanup: true
    verbose: true
    site: api-users-barfer
    script:
      - rm -rf ./bin/barfsService
      - rm -rf ./bin/web
      - rm ./package.json
      - mv ./package.usersService.json ./package.json
